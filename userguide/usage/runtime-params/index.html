<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.54.0" />
    <meta name="description" content="a tool to configure and create Kubernetes objects on multiple environments">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />
    <title>Runtime parameters :: Qbec</title>

    
    <link href="/css/nucleus.css" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css" rel="stylesheet">
    <link href="/css/hybrid.css" rel="stylesheet">
    <link href="/css/featherlight.min.css" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="/css/auto-complete.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="/css/hugo-theme.css" rel="stylesheet">
    
      <link href="/css/theme-blue.css" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    <style type="text/css">
    h1 {
        text-align: left;
        border-bottom: 4px solid #F0F2F4;
    }
    #chapter h1 {
        text-align: center !important;
    }
    #chapter p {
        text-align: left !important;
    }
    section#shortcuts h3 {
        display: none;
    }
</style>

  </head>
  <body class="" data-url="/userguide/usage/runtime-params/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <p style="text-align: left; margin:0; padding: 0">
    <a style="font-weight: bold; color: white; font-family: 'work Sans',sans-serif; font-size: 14pt" id="logo" href="http://qbec.io">
        &#9884;
        qbec
    </a>
</p>

    </div>
    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/getting-started/" title="Getting started" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/">
          Getting started
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/userguide/" title="User guide" class="dd-item 
        parent
        
        
        ">
      <a href="/userguide/">
          User guide
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/userguide/tour/" title="A quick tour of qbec" class="dd-item ">
        <a href="/userguide/tour/">
        A quick tour of qbec
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/userguide/model/" title="Core concepts" class="dd-item ">
        <a href="/userguide/model/">
        Core concepts
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/userguide/usage/" title="Using qbec" class="dd-item 
        parent
        
        
        ">
      <a href="/userguide/usage/">
          Using qbec
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/userguide/usage/basic/" title="Folders, files, parameters" class="dd-item ">
        <a href="/userguide/usage/basic/">
        Folders, files, parameters
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/userguide/usage/authoring/" title="Create components" class="dd-item ">
        <a href="/userguide/usage/authoring/">
        Create components
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/userguide/usage/runtime-params/" title="Runtime parameters" class="dd-item active">
        <a href="/userguide/usage/runtime-params/">
        Runtime parameters
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/userguide/usage/branches-and-ci/" title="Branch builds and CI" class="dd-item ">
        <a href="/userguide/usage/branches-and-ci/">
        Branch builds and CI
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/userguide/usage/commands/" title="Running qbec commands" class="dd-item ">
        <a href="/userguide/usage/commands/">
        Running qbec commands
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/userguide/usage/tips-and-tricks/" title="Tips and tricks" class="dd-item ">
        <a href="/userguide/usage/tips-and-tricks/">
        Tips and tricks
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/reference/" title="Reference" class="dd-item 
        
        
        
        ">
      <a href="/reference/">
          Reference
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/qbec-yaml/" title="Application YAML" class="dd-item ">
        <a href="/reference/qbec-yaml/">
        Application YAML
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/gen-metadata/" title="Metadata for K8s objects" class="dd-item ">
        <a href="/reference/gen-metadata/">
        Metadata for K8s objects
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/jsonnet-native-funcs/" title="Jsonnet native functions" class="dd-item ">
        <a href="/reference/jsonnet-native-funcs/">
        Jsonnet native functions
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/component-evaluation/" title="Component evaluation" class="dd-item ">
        <a href="/reference/component-evaluation/">
        Component evaluation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/diffs-and-patches/" title="Diffs and patches" class="dd-item ">
        <a href="/reference/diffs-and-patches/">
        Diffs and patches
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/garbage-collection/" title="Garbage collection" class="dd-item ">
        <a href="/reference/garbage-collection/">
        Garbage collection
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/comparison-with-other-tools/" title="Comparison with other tools" class="dd-item 
        
        
        
        ">
      <a href="/comparison-with-other-tools/">
          Comparison with other tools
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/splunk/qbec"><i class='fab fa-github'></i> Github repo</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      
    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/splunk/qbec/edit/master/site/content/userguide/usage/runtime-params.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Home</a> > <a href='/userguide/'>User guide</a> > <a href='/userguide/usage/'>Using qbec</a> > Runtime parameters
          
         
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#using-qbec-io-env">Using qbec.io/env</a></li>
<li><a href="#using-jsonnet-external-variables">Using jsonnet external variables</a></li>
<li><a href="#using-top-level-jsonnet-variables">Using top-level jsonnet variables</a>
<ul>
<li><a href="#notes-on-usage">Notes on usage</a></li>
</ul></li>
<li><a href="#strict-mode">Strict mode</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Runtime parameters</h1>
          

        




<p>Runtime parameters are values that differ across environments, change over time, or are secrets that should not
be casually revealed.</p>

<p>Properties like replicas of a deployment per environment, cluster level endpoints etc. are usually known in advance and
should be checked into source code.</p>

<p>Some parameters cannot be checked into source code. These include tags for images produced by a CI build whose value
should be subsequently used in the same build for a deployment, environment-specific secrets, etc.</p>

<p>qbec provides the following facilities for runtime parameters.</p>

<ul>
<li>it exposes the external variable <code>qbec.io/env</code> that contains the name of the environment used for the command.
This mechanism allows you to parameterize values that are known in advance for an environment.</li>
<li>it allows you to declare jsonnet <em>external variables</em> in <code>qbec.yaml</code> with default values. Values for external
variables can be supplied on the command line. Default values are used when declared variables have not be set.
This mechanism allows you to develop components locally without having to specify variables on the command line
for every invocation and still set them explicitly when you actually apply the objects to the cluster.</li>
<li>it allows you to declare jsonnet <em>top-level variables</em> in <code>qbec.yaml</code> and associate them with components to which
they should be passed. In this case, you set defaults for these variables in the jsonnet code itself.</li>
</ul>

<p>The <a href="https://jsonnet.org/learning/tutorial.html#parameterize-entire-config">jsonnet tutorial</a> explains external
and top-level variables in detail along with the pros and cons of each.</p>

<p>Let&rsquo;s examine each of these in turn.</p>

<h2 id="using-qbec-io-env">Using qbec.io/env</h2>

<p>You can access this variable using the <code>std.extVar</code> function of the jsonnet standard library and customize parameters.
This allows you to create a parameters object that can be imported by your components.</p>

<pre><code class="language-jsonnet">local env = std.extVar('qbec.io/env'); // get the value of the environment

// define baseline parameters
local baseParams = {
    components: {
        service1: {
            replicas: 1,
        },
    },
};

// define parameters per environment
local paramsByEnv = {

    _: baseParams, // the baseline environment used by qbec for some commands

    dev: baseParams {
        components+: {
            service1+: {
                replicas: 2,
            },
        },
    },

    prod: baseParams {
        components+: {
            service1+: {
                replicas: 3,
            },
        },
    },
};

// return value for correct environment
if std.objectHas(paramsByEnv, env) then paramsByEnv[env] else error 'environment ' + env ' not defined in ' + std.thisFile
 
</code></pre>

<p>When there are many components and values, the above code can be split up into multiple files with each file
returning the object for a specific environment and the top-level file then <code>import</code>s the other files.</p>

<p>Since variables and values are checked into source code when using this method, this is the most explicit way to
set parameters and should be used as much as possible.</p>

<h2 id="using-jsonnet-external-variables">Using jsonnet external variables</h2>

<p>You declare the external variable(s) that you expect in <code>qbec.yaml</code>.</p>

<pre><code class="language-yaml">spec:
    vars:
      external:
        - name: service1_image_tag
          default: latest

        - name: service1_secret
          default: changeme # fake value
          secret: true # qbec debug logs will not print this value in cleartext
</code></pre>

<p>then you can use them in your components or runtime parameter config object, like so:</p>

<pre><code class="language-jsonnet">    local imageTag = std.extVar('service1_image_tag');
</code></pre>

<p>and specify real values on the qbec command-line:</p>

<pre><code class="language-bash">export service_secret=XXX
qbec apply dev --vm:ext-str service1_image_tag=1.0.3 --vm:ext-str service1_secret
</code></pre>

<p>Note that we are explicitly setting the image tag to 1.0.3 but not providing the value for the secret on the command
line. This causes qbec to set the secret value from the environment variable with the same name. This is the preferred
method for passing in secrets.</p>

<h2 id="using-top-level-jsonnet-variables">Using top-level jsonnet variables</h2>

<p>You declare the top-level variable(s) used in your code associating them with the components that need them.</p>

<pre><code class="language-yaml">spec:
    vars:
      topLevel:
        - name: service1Tag
          components: [ 'service1' ]

        - name: service1Secret
          components: [ 'service1' ]
          secret: true # qbec debug logs will not print this value in cleartext
</code></pre>

<p>In this case you would code your <code>service1.jsonnet</code> component as follows:</p>

<pre><code class="language-jsonnet">function (service1Tag='latest', service1Secret='changeme') (
    // for example: return an array containing a seret and a deployment
    [
        {
            apiVersion: 'v1',
            kind: 'Secret',
            metadata: {
                name: 'my-secret',
            },
            data: {
                token: std.base64(service1Secret),
            },
        },
        // ... etc
    ]
)
</code></pre>

<p>and specify real values on the qbec command-line:</p>

<pre><code class="language-bash">export service1Secret=XXX
qbec apply dev --vm:tla-str service1Tag=1.0.3 --vm:tla-str service1Secret
</code></pre>

<h3 id="notes-on-usage">Notes on usage</h3>

<ul>
<li>Values (and defaults) need not be strings. They can be numbers, booleans or objects. In this case, you need to use the
<code>--vm:ext-code foo=true</code> or <code>--vm:tla-code foo=true</code> syntax. In the preceding examples, this will pass in a
true value that is a boolean instead of the string &ldquo;true&rdquo;. Use this judiciously. Requiring code variables might limit
your ability to define such variables in your IDE which may only allow string variables.</li>
<li>Excessive use of variables introduces cognitive overhead and reliance on qbec&rsquo;s defaulting features.
A few declarations are ok but think twice before defining tens of such variables.</li>
<li>Prefer to declare all external variables used by your components (qbec doesn&rsquo;t <em>require</em> you to define them) so that
the external interface of your app is documented. This will also allow you to enable strict mode.</li>
<li>You cannot share the name of a top-level variable across different components to mean different things. For example,
you cannot have a top-level argument called <code>imageTag</code> for 2 different services that need different image tags.</li>
<li>Defaults for external variables cannot be <code>null</code>. This is because qbec cannot tell the difference between a
default that was not specified versus one that was explicitly set to <code>null</code>.</li>
</ul>

<h2 id="strict-mode">Strict mode</h2>

<p>The <code>--strict-vars</code> flag for qbec commands can help you ensure correctness of your qbec command line invocation.
When this option is set, qbec:</p>

<ul>
<li>requires <em>all</em> declared values to be set on the command line</li>
<li>disallows undeclared variables to be set</li>
</ul>

<p>This is a good option to set for CI builds to ensure that the build breaks if someone introduces a new variable
but fails to set a value for it for the <code>apply</code> command, or if the variable name has a typo.</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/userguide/usage/authoring/" title="Create components"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/userguide/usage/branches-and-ci/" title="Branch builds and CI" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/perfect-scrollbar.min.js"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="/js/jquery.sticky.js"></script>
    <script src="/js/featherlight.min.js"></script>
    <script src="/js/html5shiv-printshiv.min.js"></script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js"></script>
    <script src="/js/learn.js"></script>
    <script src="/js/hugo-learn.js"></script>

    <link href="/mermaid/mermaid.css" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

